{% extends "base.html" %}
{% block morehead %}
        <script type="text/javascript">

        var urlParams;
        (window.onpopstate = function () {
            var match,
                pl     = /\+/g,  // Regex for replacing addition symbol with a space
                search = /([^&=]+)=?([^&]*)/g,
                decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
                query  = window.location.search.substring(1);

            urlParams = {};
            while (match = search.exec(query))
               urlParams[decode(match[1])] = decode(match[2]);
        })();

        var center;
        var initialLat;
        var initialLong;
        var dropMarker = false;

        if (("lat" in urlParams) && ("long" in urlParams)) {
            center = new google.maps.LatLng(urlParams["lat"], urlParams["long"]);
            dropMarker = true;
        } else {
            // Center of USA
            center = new google.maps.LatLng(39.833333, -98.583333);
        }

        function initialize() {
            var mapOptions = {
              center: center,
              zoom: 4
            };

            var map = new google.maps.Map(document.getElementById("map-canvas"),
                                          mapOptions);

            // To add the marker to the map, use the 'map' property
            if (dropMarker) {
                var marker = new google.maps.Marker({
                    position: center,
                    map: map,
                    title:"Hello World!"
                });
            }

            $.getJSON("data/us-2014-10m.json", function(data){
                geoJsonObject = topojson.feature(data, data.objects.counties)
                map.data.addGeoJson(geoJsonObject);
            });

            var featureStyle = {
                fillColor: 'black',
                fillOpacity: 0,
                strokeOpacity: .5,
                strokeWeight: .2
            }
            map.data.setStyle(featureStyle);

map.data.addListener('mouseover', function(event) {
    $("#info").text(event.feature.getProperty("COUNTY") + ', ' + event.feature.getProperty("STATE") + ' : ' + event.feature.getId());
     map.data.overrideStyle(event.feature, {strokeWeight: 2, strokeOpacity: 1});
});

map.data.addListener('mouseout', function(event) {
    map.data.revertStyle();
  });

        }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
{% endblock %}

{% block body %}
      <div id="info">US Counties</div>
      <div id="map-canvas"></div>
{% endblock %}
